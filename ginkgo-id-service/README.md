# Ginkgo ID Service

ç‹¬ç«‹çš„IDç”ŸæˆæœåŠ¡ï¼Œæä¾›é«˜æ€§èƒ½çš„åˆ†å¸ƒå¼IDç”Ÿæˆèƒ½åŠ›ã€‚

## ç‰¹æ€§

- ğŸš€ **é«˜æ€§èƒ½**ï¼šåŸºäºé›ªèŠ±ç®—æ³•ï¼Œæ”¯æŒé«˜å¹¶å‘IDç”Ÿæˆ
- ğŸ”„ **åˆ†å¸ƒå¼**ï¼šæ”¯æŒå¤šå®ä¾‹éƒ¨ç½²ï¼Œè‡ªåŠ¨åˆ†é…æœºå™¨ID
- ğŸ“Š **ç›‘æ§å®Œå–„**ï¼šæä¾›è¯¦ç»†çš„ç›‘æ§æŒ‡æ ‡å’Œå‘Šè­¦
- ğŸ”§ **é…ç½®çµæ´»**ï¼šæ”¯æŒåŠ¨æ€é…ç½®è°ƒæ•´
- ğŸ›¡ï¸ **é«˜å¯ç”¨**ï¼šæ”¯æŒé›†ç¾¤éƒ¨ç½²ï¼Œè‡ªåŠ¨æ•…éšœè½¬ç§»
- ğŸ“ˆ **å¯æ‰©å±•**ï¼šæ”¯æŒæ°´å¹³æ‰©å±•ï¼Œæ»¡è¶³å¤§è§„æ¨¡éœ€æ±‚

## æ¶æ„è®¾è®¡

### æ ¸å¿ƒç»„ä»¶

1. **IDç”Ÿæˆå¼•æ“**ï¼šåŸºäºé›ªèŠ±ç®—æ³•çš„IDç”Ÿæˆå™¨
2. **æœºå™¨IDç®¡ç†å™¨**ï¼šè‡ªåŠ¨åˆ†é…å’Œç®¡ç†æœºå™¨ID
3. **æ—¶é’ŸåŒæ­¥å™¨**ï¼šå¤„ç†æ—¶é’Ÿå›æ‹¨é—®é¢˜
4. **ç¼“å­˜ç®¡ç†å™¨**ï¼šæœ¬åœ°ç¼“å­˜ï¼Œæé«˜æ€§èƒ½
5. **ç›‘æ§ç³»ç»Ÿ**ï¼šæ€§èƒ½ç›‘æ§å’Œå‘Šè­¦

### éƒ¨ç½²æ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Load Balancer â”‚    â”‚   Load Balancer â”‚    â”‚   Load Balancer â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
          â”‚                      â”‚                      â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ID Service 1   â”‚    â”‚  ID Service 2   â”‚    â”‚  ID Service 3   â”‚
â”‚ Machine ID: 1   â”‚    â”‚ Machine ID: 2   â”‚    â”‚ Machine ID: 3   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## APIæ¥å£

### 1. ç”Ÿæˆå•ä¸ªID

```http
GET /api/id/generate
```

**å“åº”**ï¼š
```json
{
  "success": true,
  "data": 1234567890123456789,
  "message": "success"
}
```

### 2. æ‰¹é‡ç”ŸæˆID

```http
POST /api/id/batch
Content-Type: application/json

{
  "count": 100
}
```

**å“åº”**ï¼š
```json
{
  "success": true,
  "data": [1234567890123456789, 1234567890123456790, ...],
  "message": "success"
}
```

### 3. è·å–æœåŠ¡çŠ¶æ€

```http
GET /api/id/status
```

**å“åº”**ï¼š
```json
{
  "success": true,
  "data": {
    "machineId": 1,
    "sequence": 1234,
    "timestamp": 1640995200000,
    "uptime": 86400000
  },
  "message": "success"
}
```

## é…ç½®

### application.yml

```yaml
server:
  port: 8080

ginkgo:
  id:
    snowflake:
      machine-id: ${MACHINE_ID:1}
      buffer-size: 1000
      fill-batch-size: 100
      max-idle-time: 1000
    cluster:
      enabled: true
      zookeeper:
        connect-string: ${ZK_CONNECT_STRING:localhost:2181}
        namespace: ginkgo-id-service
    monitoring:
      enabled: true
      metrics-port: 9090
```

### ç¯å¢ƒå˜é‡

- `MACHINE_ID`: æœºå™¨IDï¼ˆå¯é€‰ï¼Œè‡ªåŠ¨åˆ†é…ï¼‰
- `ZK_CONNECT_STRING`: ZooKeeperè¿æ¥å­—ç¬¦ä¸²
- `SERVER_PORT`: æœåŠ¡ç«¯å£

## éƒ¨ç½²

### Dockeréƒ¨ç½²

```bash
# æ„å»ºé•œåƒ
docker build -t ginkgo-id-service .

# è¿è¡Œå®¹å™¨
docker run -d \
  --name ginkgo-id-service \
  -p 8080:8080 \
  -p 9090:9090 \
  -e MACHINE_ID=1 \
  ginkgo-id-service
```

### Kuberneteséƒ¨ç½²

```yaml
apiVersion: apps/v1
kind: Deployment
metadata:
  name: ginkgo-id-service
spec:
  replicas: 3
  selector:
    matchLabels:
      app: ginkgo-id-service
  template:
    metadata:
      labels:
        app: ginkgo-id-service
    spec:
      containers:
      - name: ginkgo-id-service
        image: ginkgo-id-service:latest
        ports:
        - containerPort: 8080
        - containerPort: 9090
        env:
        - name: MACHINE_ID
          valueFrom:
            fieldRef:
              fieldPath: metadata.name
```

## ç›‘æ§

### æŒ‡æ ‡

- `id_generated_total`: ç”Ÿæˆçš„IDæ€»æ•°
- `id_generation_duration`: IDç”Ÿæˆè€—æ—¶
- `id_cache_hit_rate`: ç¼“å­˜å‘½ä¸­ç‡
- `id_machine_id`: å½“å‰æœºå™¨ID
- `id_sequence_overflow`: åºåˆ—å·æº¢å‡ºæ¬¡æ•°

### å‘Šè­¦

- IDç”Ÿæˆå¤±è´¥ç‡ > 1%
- IDç”Ÿæˆè€—æ—¶ > 10ms
- ç¼“å­˜å‘½ä¸­ç‡ < 80%
- æ—¶é’Ÿå›æ‹¨æ£€æµ‹

## æ€§èƒ½

### åŸºå‡†æµ‹è¯•

- **å•æœºæ€§èƒ½**ï¼š10ä¸‡ID/ç§’
- **é›†ç¾¤æ€§èƒ½**ï¼š100ä¸‡ID/ç§’ï¼ˆ10èŠ‚ç‚¹ï¼‰
- **å»¶è¿Ÿ**ï¼š< 1msï¼ˆP99ï¼‰
- **å¯ç”¨æ€§**ï¼š99.99%

### ä¼˜åŒ–ç­–ç•¥

1. **æœ¬åœ°ç¼“å­˜**ï¼šé¢„ç”ŸæˆIDç¼“å­˜
2. **æ‰¹é‡å¤„ç†**ï¼šæ”¯æŒæ‰¹é‡IDç”Ÿæˆ
3. **è¿æ¥æ± **ï¼šHTTPè¿æ¥å¤ç”¨
4. **å¼‚æ­¥å¤„ç†**ï¼šéé˜»å¡IDç”Ÿæˆ

## æ•…éšœå¤„ç†

### æ—¶é’Ÿå›æ‹¨

- è‡ªåŠ¨æ£€æµ‹æ—¶é’Ÿå›æ‹¨
- ç­‰å¾…æ—¶é’Ÿæ¢å¤
- è®°å½•å›æ‹¨äº‹ä»¶

### æœºå™¨IDå†²çª

- è‡ªåŠ¨æ£€æµ‹å†²çª
- é‡æ–°åˆ†é…æœºå™¨ID
- è®°å½•å†²çªäº‹ä»¶

### æœåŠ¡ä¸å¯ç”¨

- å¥åº·æ£€æŸ¥
- è‡ªåŠ¨æ•…éšœè½¬ç§»
- é™çº§ç­–ç•¥

## æœ€ä½³å®è·µ

### 1. éƒ¨ç½²å»ºè®®

- è‡³å°‘éƒ¨ç½²3ä¸ªå®ä¾‹
- ä½¿ç”¨è´Ÿè½½å‡è¡¡å™¨
- é…ç½®ç›‘æ§å’Œå‘Šè­¦
- å®šæœŸå¤‡ä»½é…ç½®

### 2. ä½¿ç”¨å»ºè®®

- ä½¿ç”¨æ‰¹é‡æ¥å£å‡å°‘ç½‘ç»œè°ƒç”¨
- é…ç½®åˆé€‚çš„è¶…æ—¶æ—¶é—´
- å®ç°é‡è¯•æœºåˆ¶
- ç›‘æ§æœåŠ¡çŠ¶æ€

### 3. è¿ç»´å»ºè®®

- å®šæœŸæ£€æŸ¥æ—¥å¿—
- ç›‘æ§æ€§èƒ½æŒ‡æ ‡
- åŠæ—¶å¤„ç†å‘Šè­¦
- å®šæœŸæ›´æ–°ç‰ˆæœ¬

## è®¸å¯è¯

MIT License 